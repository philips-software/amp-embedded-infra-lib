<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Execution Model :: Embedded Infrastructure Library</title>
    <link rel="canonical" href="https://philips-software.github.io/amp-embedded-infra-lib/embedded_infrastructure_library/7.0.0/ExecutionModel.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/centralesans.css">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="icon" href="../../favicon.svg" type="image/svg+xml">

    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="../../_/css/centralesans.css">

      </head>
  <body class="article">
<header class="header" role="banner">
    <div class="header-top-row">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-brand">
                    <a class="navbar-brand">
                        <img class="scale-down"  src="../../philips-logo.png" alt="Philips"/>
                    </a>
                    <a class="navbar-item" href="https://philips-software.github.io/amp-embedded-infra-lib">Embedded Infrastructure Library</a>
                    <button class="navbar-burger" data-target="topbar-nav">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
                <div id="topbar-nav" class="navbar-menu">
                    <div class="navbar-end">
                        <a class="navbar-item" href="https://github.com/philips-software/amp-embedded-infra-lib">
                            <span class="icon">
                                <svg aria-labelledby="simpleicons-github-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <title id="simpleicons-github-icon">GitHub</title>
                                <path fill="#f5f5f5" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
                            </span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</header>
<div class="body">
<main class="article">
<div class="toolbar toolbar-wrap">
  <div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
    <a href="index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Embedded Infrastructure Library documentation</a></li>
    <li><a href="ExecutionModel.html">Execution Model</a></li>
  </ul>
</nav>
      <div class="edit-this-page"><a href="https://github.com/philips-software/amp-embedded-infra-lib/edit/main/documents/modules/ROOT/pages/ExecutionModel.adoc">Edit this page</a></div>
      </div>
</div>
  <div class="content">
<div class="nav-container" data-component="embedded_infrastructure_library" data-version="7.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Embedded Infrastructure Library documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="ExecutionModel.html">Execution Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="MemoryRange.html">MemoryRange</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Containers.html">Containers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Echo.html">Echo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Sesame.html">Sesame</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="NetworkConnections.html">NetworkConnections</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CodingStandard.html">Coding Standard</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div></div>
    </div>
  </aside>
</div>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Execution Model</h1>
<div class="sect1">
<h2 id="_execution_by_using_an_event_dispatcher"><a class="anchor" href="#_execution_by_using_an_event_dispatcher"></a>Execution by using an event dispatcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Embedded Infrastructure Library supports various execution models, but the most important execution model is execution by
scheduling blocks of work on an event dispatcher. This is a lightweight way of being able to perform multiple tasks
in parallel, without needing multiple stacks or synchronization.</p>
</div>
<div class="paragraph">
<p>The event dispatcher is used by scheduling an action by using its <code>Schedule()</code> method. <code>Schedule()</code> takes a single argument of
type <code>infra::Function&lt;void()&gt;</code>, and is therefore often used in combination with lambda functions. <code>Schedule()</code> does not
execute its action immediately, but pushes it on a queue for later execution. The event dispatcher is typically constantly
running on the application&#8217;s main thread, and executes queued actions one after another. This way, a scheduled action is
completely finished before the next action is started, so in contrast with running actions in different threads no synchronization
is needed.</p>
</div>
<div class="paragraph">
<p>An action executed by an event dispatcher should never waste any time; no action should ever sleep, waiting for an external task, such as
a write towards flash, to finish. Instead, after having started a write towards flash, a new action is scheduled when the write has
been finished. In the meantime, other actions can execute. This creates a decoupling between various different pieces of business
logic: while one piece is busy with writing to flash, another piece may be answering an HTTP request, or reading out a temperature
sensor. No real-time behaviour is guaranteed on the event dispatcher (any real-time behaviour required is implemented outside of
event dispatchers, by either interrupt handlers or by using threads), but multiple components can flawlessly share execution
time, with each component making steady progress.</p>
</div>
<div class="paragraph">
<p>While it is possible to have multiple event dispatchers (when using multiple threads, a specific thread may have its own event
dispatcher for dedicated tasks), there is one event dispatcher globally available via <code>infra::EventDispatcher::Instance()</code>.
This event dispatcher is used for generic tasks; for example, the <code>ConfigurationStore</code> uses the <code>Flash</code> interface to read and write
towards flash; the completion of a read or write action is dispatched on this globally available event dispatcher. A typical
<code>main</code> function will therefore start with declaring an event dispatcher, and end with invoking that event dispatcher&#8217;s <code>Run()</code> method.</p>
</div>
<div class="sect2">
<h3 id="_support_for_infraweakptr"><a class="anchor" href="#_support_for_infraweakptr"></a>Support for <code>infra::WeakPtr</code></h3>
<div class="paragraph">
<p>Objects that are managed by shared pointers may schedule actions to be executed, but it may happen that that object is destroyed before
that action is executed. In that case, that action should be discarded instead of being executed. <code>infra::EventDispatcherWithWeakPtr</code>
exists to facilitate this usecase. Next to the typical <code>Schedule()</code> function that takes an action as parameter, it supports an
overload that takes a second parameter: an <code>infra::WeakPtr&lt;T&gt;</code> towards the object that schedules the action. That parameter is
converted to a shared pointer just before executing the action: if this conversion succeeds, the object is still alive, and the action
is executed with that shared pointer as parameter. If the conversion fails, then the object was already expired, and execution of
that action is skipped.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_threaded_execution"><a class="anchor" href="#_multi_threaded_execution"></a>Multi-threaded execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While currently no component in Embedded Infrastructure Library requires the usage of multiple threads, it is perfectly viable
to use an operating system to start more than one thread. A reason to use multiple threads include having a dedicated thread for
executing tasks that require real-time behaviour. By separating execution of the event dispatcher and execution of time-critical
tasks, enough execution time can be guaranteed for real-time behaviour.</p>
</div>
<div class="paragraph">
<p>Another reason for using multiple threads is when a certain action takes a considerable amount of time, for instance generating
a certificate takes multiple seconds. Executing that action on the main event dispatcher would delay the execution of other actions;
a solution to this could be to generate the certificate in its own thread, and its completion can be scheduled on the main event dispatcher.</p>
</div>
<div class="paragraph">
<p>A thread may have its own event dispatcher. This removes the need for starting and stopping a thread; when a thread-aware event dispatcher is idle,
it will pause its thread, and it will wake up its thread when new work is scheduled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_execution_without_an_event_dispatcher"><a class="anchor" href="#_execution_without_an_event_dispatcher"></a>Execution without an event dispatcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some applications do not benefit from having an event dispatcher. A boot loader&#8217;s main focus is to be small and execute one thing;
it only loads an application and therefore has no need to execute multiple actions in parallel. The small overhead that an event
dispatcher brings does not bring any benefits, and should therefore not be needed in a boot loader. For this kind of usecase,
variations of the interfaces for interacting with peripherals exist which work synchronously; they do not need to schedule their
completion on an event dispatcher, but they complete their activities before returning. While for other libraries this is often
the default behaviour, for Embedded Infrastructure Library this is the exception.</p>
</div>
<div class="paragraph">
<p>A number of components in Embedded Infrastructure Library assume the presence of an event dispatcher. This includes any component
that makes use of an asynchronous interface. Obviously, without an event dispatcher such components cannot be used.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Â© Koninklijke Philips N.V., 2022. All rights reserved.</p>
</footer>

<script type="text/javascript" src="../../_/js/medium-zoom.min.js"></script>
<script type="text/javascript">
mediumZoom('.data-zoomable img', {
  margin: 50,
  background: '#FFFFFFA1',
})
</script>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
